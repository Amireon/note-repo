本章重点分析I/O设备与主机交换信息的三种控制方式（程序控制、中断和DMA）及其相应的接口功能和组成，对几种常用的I/O设备也进行了简单介绍.

章节总览
![](https://ypic.oss-cn-hangzhou.aliyuncs.com/202301311709891.png)


## 5.1 I/O系统基本概念
### 1.I/O系统演变过程
**1.早期**
特点：CPU和I/O串行工作，分散连接
I/O控制方式: 程序查询方式，

![](https://ypic.oss-cn-hangzhou.aliyuncs.com/202301311613514.png)

**2.接口和DMA阶段**
特点：CPU和I/O接口并行工作，总线连接
I/O控制方式: 
- 中断控制方式: 只有I/O设备准备就绪并向CPU发送中断请求才予以响应，CPU与I/O不能绝对并行，
- DMA方式: 直接存储器存取(Direct Memory Access), 主存与I/O设备之间有一条直接数据通路，当主存与I/O设备交换数据时，无需发送中断请求，常用于微机实现高速I/O设备与主存的数据交换

![](https://ypic.oss-cn-hangzhou.aliyuncs.com/202301311614278.png)

**3.具有I/O通道结构的阶段**
特点: 在大中型计算机系统中，采用I/O通道方式交换数据
在系统中设有通道控制部件，每个通道连接若干外设，主机在执行I/O命令时，只需启动有关通道，通道将执行通道程序，完成I/O操作，而CPU不参与直接管理

**4.具有I/O处理机的阶段**
特点: I/O处理机又被称为外围处理机


### 2.I/O系统基本组成
一般来说，I/0系统由I/O软件和I/O硬件两部分构成

**1.I/O软件**
通常采用I/O指令和通道指令实现CPU和I/O设备的信息交换
- I/O指令：CPU指令的一部分，操作码+命令码+设备码
- 通道指令：通道自身的指令，指出数组的首地址、传送字数、操作命令;存放在主存中;位数一般较长

**2.I/O硬件**
包括外部设备、设备控制器和接口、I/O总线等

![](https://ypic.oss-cn-hangzhou.aliyuncs.com/202212101027751.png)

### 3.I/O设备编址方式
**1.统一编制**
- 把I/O地址当做存储器地址的一部分，用统一的**访存指令**访问I/O端口，又称存储器映射方式
- 区分方式: 依靠不同的**地址码**区分内存和I/O设备，I/O地址要求相对固定在地址的某部分。
- **优点**：不需要专门的输入/输出指令，可使CPU访问I/O的操作更灵活、更方便，还可使端口有较大的编址空间
- **缺点**：端口占用了存储器地址，减少主存容量；利用存储器编址的I/O设备进行数据输入/输出操作，执行速度较慢

![](https://ypic.oss-cn-hangzhou.aliyuncs.com/202212151517206.png)


**2.独立编址（不统一编址）**
- I/O端口地址与存储器地址无关，CPU设置**专门的I/O指令**访问端口，又称I/O映射方式
- 区分方式: 依靠不同的指令区分内存和I/O设备
- **优点**：I/O指令与存储器指令有明显区别，程序编制清晰
- **缺点**：需要额外I/O控制指令；输入/输出指令少，一般只能对端口进行传送操作，尤其需要CPU提供存储器读/写、I/O设备读/写两组控制信号，增加了控制的复杂性

![](https://ypic.oss-cn-hangzhou.aliyuncs.com/202212151517208.png)


**小结**

![](https://ypic.oss-cn-hangzhou.aliyuncs.com/202212101049757.png)

### 4.I/O设备的控制方式
五种: 程序查询方式，程序中断方式，DMA方式，I/O通道方式，I/O处理机方式

**1.程序查询方式** 
- I/O接口内置一个能反映I/O设备是否准备就绪的状态标记
- CPU 和 I/O 串行工作，踏步等待
- 按"字"读取I/O设备数据，经CPU送给主存
- 一旦启动I/O设备，CPU便不断查询I/O设备的准备情况，无法执行原程序

![](https://ypic.oss-cn-hangzhou.aliyuncs.com/202301311647315.png)


**2.程序中断方式**
只有当I/O设备准备就绪并向CPU发送中断请求后，CPU才响应I/O设备

- 当I/O设备处于准备状态时，CPU不执行I/O指令
- 当I/O设备将要与主机交换信息时，CPU暂停现行程序，通过中断服务程序

![](https://ypic.oss-cn-hangzhou.aliyuncs.com/202301311651822.png)

**3.DMA方式**
- 主存与I/O之间有一条直接数据通道
- 不中断现行程序，CPU和I/O并行工作
- 周期挪用: 一个存取周期
- 若同时访问主存，CPU让渡访问权

![](https://ypic.oss-cn-hangzhou.aliyuncs.com/202301311653494.png)


**4.三种方式的CPU工作效率比较**
- 程序查询方式：串行，无中断，
- 程序中断方式: 串行，有中断，
- DMA方式：并行，无中断，

![](https://ypic.oss-cn-hangzhou.aliyuncs.com/202301311951643.png)


## 5.2 I/O接口

为什么要设备接口？
- 实现设备的选择
- 实现数据缓冲，来速度匹配
- 实现数据串-并格式的转换
- 实现电平转换
- 传送控制命令
- 反映设备的状态（“忙”、“就绪”、“中断请求”）

### 1.接口的功能和组成
**总线连接方式的I/O接口电路**
| 功能         | 组成                   |
| ------------ | ---------------------- |
| 选址功能     | 设备选择电路           |
| 传送命令     | 命令寄存器，命令译码器 |
| 传送数据     | 数据缓冲寄存器         |
| 反映设备状态 | 设备状态标记           |

设备状态标记组成：
- 完成触发器D
- 工作触发器B
- 中断请求触发器INTR
- 屏蔽触发器MASK

- 内部接口：与系统总线相连，数据只能并行传输
- 外部接口：通过接口电缆与外设相连，数据不一定是并行传输，需要串/并转换功能

![](https://ypic.oss-cn-hangzhou.aliyuncs.com/202301311942086.png)


### 2.接口分类

1.按数据 传送方式 分类
- 并行接口: Intel 8255
- 串行接口: Intel 8251

2.按功能 选择的灵活性 分类
- 可编程接口: Intel 8255、 Intel 8251
- 不可编程接口: Intel 8212

3.按 通用性 分类
- 通用接口: Intel 8255, Intel 8251
- 专用接口: Intel 8279, Intel 8275

4.按数据传送的 控制方式 分类
- 中断接口: Intel 8259
- DMA接口: Intel 8259

![](https://ypic.oss-cn-hangzhou.aliyuncs.com/202212101119980.png)


## 5.3 程序查询方式
**1.程序查询方式概述**
- 特点：CPU会“踏步等待”；CPU与I/O设备串行工作
- 优点：接口设计简单，设备量少
- 缺点：CPU需花费很多时间查询和等待；CPU在一段时间内 只能控制一台I/O设备，资源利用率低

![](https://ypic.oss-cn-hangzhou.aliyuncs.com/202301311954515.png)


**程序查询方式接口结构**
一次只能传输一个字的原因：数据需要经过CPU寄存器进入主存

![](https://ypic.oss-cn-hangzhou.aliyuncs.com/202301311958727.png)


**一个例题**
![](https://ypic.oss-cn-hangzhou.aliyuncs.com/202301312005069.png)


## 5.4 程序中断方式

![](https://ypic.oss-cn-hangzhou.aliyuncs.com/202301312008563.png)


### 1.中断的的基本概念
程序中断是指在计算机执行现行程序的过程中，出现某些急需处理的异常情况或特殊请求，CPU暂时中止现行程序，而转去对这些异常情况或特殊请求进行处理，在处理完毕后CPU又自动返回到现行程序的断点处，继续执行原程序。

工作流程:
1. 中断请求: 中断源向CPU发送中断请求信号
2. 中断响应
	- 响应中断的条件
	- 中断判优：多个中断源同时提出请求时通过中断判优逻辑响应一个中断源
3. 中断处理
	- 中断隐指令。
	- 中断服务程序。

![](https://ypic.oss-cn-hangzhou.aliyuncs.com/202301312037699.png)


### 单重中断与多重中断

![](https://ypic.oss-cn-hangzhou.aliyuncs.com/202301312040310.png)


## 5.5 DMA方式

每准各好一个数据都要中断CPU，由CPU运行中断服务程序来完成一次传送兹盘机、磁带机等高速设备需要大批量的数据传送→ CPU大量时间用于中断服务由硬件实现控制大批量的数据传送今DMA控制器

![](https://ypic.oss-cn-hangzhou.aliyuncs.com/202301312045295.png)


### DMA与主存交换数据的方式
主存和DMA控制器之间有一条数据通路，因此主存和|/0设备之间交换信息时，不通过CPU。但当I/0设备和CPU
同时访问主存时，可能发生冲突，为了有效地使用主存，DMA控制器与CPU通常米用以下3种方法使用主存。

**(1）停止CPU访问主存**
- 优点：控制简单
- 缺点：CPU处于不工作状态或保持状态；未充分发挥CPU对主存的利用率

![](https://ypic.oss-cn-hangzhou.aliyuncs.com/202301312056025.png)

**(2) DMA与CPU交替访存**
- 优点：不需要总线使用权的申请、建立和归还过程
- 缺点：硬件逻辑更为复杂

![](https://ypic.oss-cn-hangzhou.aliyuncs.com/202301312057201.png)

**(3)周期挪用(周期窃取)**
DMA访问主存有三种可能：
- CPU此时不访存
- CPU正在访存：存取周期结束让出总线
- CPU与DMA同时请求访存：DMA访存优先

![](https://ypic.oss-cn-hangzhou.aliyuncs.com/202301312059887.png)


### DMA的工作过程
DMA传送过程：预处理、数据传送、后处理

预处理
- 设备地址 -> DMA的DAR
- 主存地址 -> DMA的AR
- 传送字数 -> DMA的WC

数据传送

![](https://ypic.oss-cn-hangzhou.aliyuncs.com/202301312051658.png)

![](https://ypic.oss-cn-hangzhou.aliyuncs.com/202301312051000.png)


### DMA方式与中断方式

![](https://ypic.oss-cn-hangzhou.aliyuncs.com/202301312102808.png)


|          |                   中断                    |                          DMA                          |
| :------: | :---------------------------------------: | :---------------------------------------------------: |
| 数据传送 | 程序控制；<br />程序的切换→保存和恢复现场 |       硬件控制；<br />CPU只需进行预处理和后处理       |
| 中断请求 |                 传送数据                  |                        后处理                         |
|   响应   |        指令执行周期结束后响应中断         | 每个机器周期结束均可，<br />总线空闲时即可响应DMA请求 |
|   场景   |             CPU控制，低速设备             |                DMA控制器控制，高速设各                |
|  优先级  |               优先级低于DMA               |                    优先级高于中断                     |
| 异常处理 |              能处理异常事件               |                      仅传送数据                       |

### 小结

![DMA小结](https://ypic.oss-cn-hangzhou.aliyuncs.com/202301312109906.png)


## 本章考研大纲

![](https://ypic.oss-cn-hangzhou.aliyuncs.com/202301312101308.png)
