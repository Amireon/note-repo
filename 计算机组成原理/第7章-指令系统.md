本章主要介绍机器指令系统的分类，常见的寻址方式、指令格式，也简要介绍了 RISC 技术。
人们习惯把每一条机器语言的语句称为机器指令，将全部机器指令的集合称为机器的指令系统。
![](https://ypic.oss-cn-hangzhou.aliyuncs.com/202210301139831.png)

## 7.1 机器指令
### 指令格式-地址码
`指令=操作码字段+地址码字段`

![](https://ypic.oss-cn-hangzhou.aliyuncs.com/202210301705386.png)

### 指令格式-操作码
1. 操作码指出指令中该指令应该执行什么性质的操作和具有何种功能
2. 操作码是识别指令、了解指令功能与区分操作数地址内容的组成和使用方法等的关键信息。例
如，指出是算术加运算，还是减运算；是程序转移，还是返回操作。

#### 操作码分类
**1.定长操作码**
- 含义：在指令字的最高为部分分配固定的若干位（定长）表示操作码，
- 一般n位操作码字段的指令系统最大能够表示 $2^n$ 条指令
- 优：定长操作码对于简化计算机硬件设计，提高指令译码和识别速度很有利
- 缺：指令数量增加时会占用更多固定位，留给表示操作数地址的位数受限

**2.扩展操作码(不定长操作码)**：
- 含义：全部指令的操作码字段的位数不固定，且分散地放在指令字的不同位置上，
- 最常见的变长操作码方法是扩展操作码，使操作码的长度随地址码的减少而增加，不同地址数的指令可以具有不同长度的操作码，从而在满足需要的前提下，有效地缩短指令字长。
- 优：在指令字长有限的前提下仍保持比较丰富的指令种类;
- 缺：增加了指令译码和分析的难度，使控制器的设计复杂化

#### 扩展操作码
**注意事项**：
- 不允许短码是长码的前缀，即短操作码不能与长操作码的前面部分的代码相同。
- 各指令的操作码一定不能重复

通常情况下，对使用频率较高的指令，分配较短的操作码：
对使用频率较低的指令，分配较长的操作码，从而尽可能减少指令译码和分析的时间。

![](https://ypic.oss-cn-hangzhou.aliyuncs.com/202210301711272.png)

**例题**
![](https://ypic.oss-cn-hangzhou.aliyuncs.com/202210301713320.png)

## 7.2 操作数类型和操作类型
**1.数据传送**
数据传送类：进行主存与 CPU 之间的数据传送
- `LOAD`：把存储器中的数据放到寄存器中
- `STORE`：把寄存器中的数据放到存储器中

**2.算术逻辑操作**
运算类
- 算术：加、减、乘、除、增1、减1、求补、浮点运算、十进制运算
- 逻辑：与、或、非、异或、位操作、位测试、位清除、位求反

**3.移位操作**
算术移位、逻辑移位、循环移位（带进位和不带进位）

**4.转移操作**
程序控制类：改变程序执行的顺序
- 无条件转移`JMP`
- 条件转移`JZ`：结果为0;JO：结果溢出；JC：结果有进位
- 调用`CALL`，返回`RETURN`
- 陷阱`Trap`与陷阱指令

**5.输入输出操作**
输入输出类（I/0）：进行CPU和I/0设备之间的数据传送
- CPU寄存器与IO端口之间的数据传送(端口即IO接口中的寄存器)

## 7.3 寻址方式
- 寻址方式：确定本条指令的数据地址，和下一条将要执行的指令地址的方法，
- 寻址方式分为两种：指令寻址和数据寻址

常见的几种地址
- 形式地址：指向有效地址的存储单元的位置
- 有效地址：是构成逻辑地址的一部分
- 逻辑地址：是物理地址的虚拟化表示，等于段地址+偏移量（有效地址）
- 物理地址：是存储器的地址，是内存单元的绝对地址

### 1.指令寻址
指令寻址如何定位下一条指令的地址：**始终由程序计数器PC给出**
基本方式有两种：
- 顺序寻址：（PC）+ 1 ——> PC
- 跳跃寻址：由转移指令给出

![](https://ypic.oss-cn-hangzhou.aliyuncs.com/202210301218527.png)

- 前3条指令的执行方式一致：PC读入指令地址，执行完毕后 （PC）——> PC，
- 当指令地址为3时，操作码是 JMP，意味着 PC 需邀跳转至该条指令地址码的位置

### 2.数据寻址
1.一种一地址指令的格式：`操作码 + 寻址特征 + 形式地址A`
- 指令的地址码字段通常不代表操作数的真实地址，称为形式地址，记作A
- 操作数的真实地址称为有效地址，记作 EA

2.约定: `指令字长 = 存储字长 = 机器字长`
- 指令字长：一个指令字中包含二进制代码的位数
- 存储字长：一个存储单元中存储二进制代码的长度
- 机器字长：CPU一次性能处理的二进制数据的位数

3.数据寻址方式

![](https://ypic.oss-cn-hangzhou.aliyuncs.com/202210301647780.png)

4.以`MOV AX A`指令为例，当A为如下几种时对应的寻址方式：
- `3`：立即寻址
- `[3]`：直接寻址
- `R`：寄存器寻址
- `[R]`：寄存器间接寻址
- `[BR + 3]`：基址寻址
- `[IX] + 3`：变址寻址

#### 立即寻址
- 特点：形式地址 A 就是操作数本身
- 执行阶段访存次数：0次，因为只需取指令时访问1次
- 优点：指令执行阶段比访存
- 缺点：A的位数限制了立即数的范围

![](https://ypic.oss-cn-hangzhou.aliyuncs.com/202211041320117.png)

#### 直接寻址
- 特点：指令字中的形式地址A就是操作数的真实地址EA，即EA = A
- 执行阶段访存次数：1次，因为取指令访存1次，执行指令访存1次，
- 优点：寻找操作数比较简单；指令执行阶段只访问一次主存
- 缺点：A的位数限制了操作数的寻址范围；操作数的地址不易修改(必须修改A)

![](https://ypic.oss-cn-hangzhou.aliyuncs.com/202210301534884.png)

#### 隐含寻址
- 隐含寻址：操作数地址隐藏在操作码或某个寄存器中
- 优点：有利于缩短指令字长
- 缺点：需增加存储操作数或隐含地址的硬件

![](https://ypic.oss-cn-hangzhou.aliyuncs.com/202210301551479.png)


#### 间接寻址
- 间接寻址：指令字中的地址不直接给出操作数的地址，而是给出操作数有效地址所在的存储单元地址，也就是，有效地址是由形式地址间接提供的，即 EA = （A）
- 对于一次间址，A地址单元的内容EA是操作数的有效地址，EA指向的内容才是真正的操作数
- 执行阶段访存次数：2次以上，因为执行阶段一次间址访问2次
- 优点: 扩大寻址范围，有效地址EA的位数大于形式地址A的位数；便于编制程序，用间接寻址可以方便地完成于程序返回
- 缺点：指令在执行阶段要多次访存，一次间址需两次访存，多次寻址需根据存储字的最高位确定几次访存

![](https://ypic.oss-cn-hangzhou.aliyuncs.com/202210301729356.png)

#### 寄存器寻址
- 寄存器寻址：有效地址即为寄存器编号，即 EA = $R_i$ ，其操作数在由 $R_i$ 所指的寄存器内
- 执行阶段访存次数：0次，因为取指令访存1次，执行指令访存0次
- 优点：指令执行阶段无需访存，减少了执行时间；指令字短且执行速度快，支持向量、矩阵运算
- 缺点：寄存器价格昂贵，个数有限

![](https://ypic.oss-cn-hangzhou.aliyuncs.com/202210301546282.png)


#### 寄存器间接寻址
- 寄存器间接寻址：有效地址在寄存器中，EA=($R_i$)
- 有效地址在寄存器中，操作数在存储器中
- 执行阶段访存次数： 1次，因为通过寄存器编号取EA指向的操作数
- 优点：执行阶段只需访存1次

![](https://ypic.oss-cn-hangzhou.aliyuncs.com/202210301548674.png)


#### 基址寻址
- 基址寻址：将中基址寄存器（BR）的内容加上指令格式中的形式地址A，形成操作数的有效地址，即` EA = (BR)+ A`
- 基址寄存器可以是专用寄存器，也可以是通用寄存器，内容由操作系统决定
- 在程序执行过程中，基址寄存器的内容不变（基地址），形式地址可变（偏移量）

优点
- 扩大寻址范围（基址寄存器的位数大于形式地址A的位数）
- 用户不必考虑程序存于主存的哪一空间区域，故有利于多道程序设计，以及可用于编制浮动程序

![](https://ypic.oss-cn-hangzhou.aliyuncs.com/202210301557312.png)


![](https://ypic.oss-cn-hangzhou.aliyuncs.com/202210301606619.png)


#### 变址寻址
- 变址寻址：有效地址EA等于指令字中的形式地址A与变址寄存器IX的内容相加，`EA = (IX)+A`，
- IX可以是专用的变址寄存器，也可以是通用寄存器
- 在程序执行过程中，IX内容可变(偏移量），形式地址A不变（基地址）

**优点**
- 扩大寻址范围，变址寄存器的位数大于形式地址A的位数
- 在数组处理过程中，可设定A为数组的首地址，不断改变变址寄存器IX的内容，便可很容易形成数组中任数据的地址，特别适合编制循环程序

![](https://ypic.oss-cn-hangzhou.aliyuncs.com/202210301610638.png)


**基址寻址与变址寻址**

![基址寻址与变址寻址](https://ypic.oss-cn-hangzhou.aliyuncs.com/202210301633655.png)

![](https://ypic.oss-cn-hangzhou.aliyuncs.com/202210301636567.png)

#### 相对寻址
- 相对寻址：有效地址是将程序计数器 PC 的内容（即当前指令的地址）与指令字中的形式地址 A 相加而成，即 EA = (PC) + A，A是相对于当前指令地址的位移量，可正可负，补码表示。
- A的位数决定操作数的寻址范围
- 操作数的地址是不固定的， 便于程序浮动
- 广泛应用于转移指令

![](https://ypic.oss-cn-hangzhou.aliyuncs.com/202210301628644.png)

**相对寻址举例**

![](https://ypic.oss-cn-hangzhou.aliyuncs.com/202211041336516.png)


#### 堆栈寻址
- **堆栈寻址**：操作数存放在堆栈中，隐含使用堆栈指针（SP）作为操作数地址

先进后出
- 先进后出（一个入出口)，栈顶地址由SP 指出
- 栈顶地位地址，栈底低位地址
- 进栈 ( SP）一  1 —> SP，出栈（SP）+ 1 ——> SP

![](https://ypic.oss-cn-hangzhou.aliyuncs.com/202211041421831.png)


![](https://ypic.oss-cn-hangzhou.aliyuncs.com/202210301658223.png)

- 硬堆栈：多个寄存器
- 软堆栈：指定的存储空间

![](https://ypic.oss-cn-hangzhou.aliyuncs.com/202210301658531.png)


# 7.4 指令格式举例
## 1.设置指令格式的考虑因素
1. 指令系统的兼容性(向上兼容)
2. 操作类型：包括指令个数及操作的难易程度
3. 数据类型：确定哪些数据类型可参与操作
4. 指令格式：指令字长是否固定
5. 操作码位数、是否采用扩展操作码技术
6. 地址码位数、地址个数、寻址方式类型
7. 寻址方式：指令寻址、操作数寻址
8. 寄存器个数：寄存器的多少直楼影响指令的执行时间

## 2.指令格式举例
PDP-8

![](https://ypic.oss-cn-hangzhou.aliyuncs.com/202211041425424.png)

PDP-11

![](https://ypic.oss-cn-hangzhou.aliyuncs.com/202211041425763.png)

IDM 360

![](https://ypic.oss-cn-hangzhou.aliyuncs.com/202211041426605.png)


Intel 8086

![](https://ypic.oss-cn-hangzhou.aliyuncs.com/202211041426297.png)

# 7.5 CISC和RISC
RISC的产生和发展：80-20规律，典型程序中80%的语句仅仅使用处理机中20%的指令

## RISC和CISC特征比较
| 科目         | RISC                                         | CISC                                       |
| ------------ | -------------------------------------------- | ------------------------------------------ |
| 指令选择     | 选用频度较高的简单指令                       | 系统指令复杂庞大，各种指令使用频度相差大   |
| 指令特征     | 指令长度固定，指令格式种类少，寻址方式种类少 | 指令长度不固定、指令格式种类多、寻址方式多 |
| 访存         | 只有LOAD/STORE指令访存                       | 访存指令不受限制                           |
| 寄存器       | CPU中有多个通用寄存器                        | CPU中设有专用寄存器                        |
| 指令执行时间 | 流水技术，一个时钟周期完成一条指令           | 大多数指令需要耗费多个时钟周期             |
| 控制器       | 采用组合逻辑实现控制器                       | 采用微程序控制器                           |
| 编译程序     | 采用优化的编译程序                           | 难以优化编译来生成高效的目的代码           |

## RISC的优缺点
1. RISC 更能充分利用 VLSI 芯片的面积
2. RISC 更能提供计算机运算速度
	- 指令数、指令格式、寻址方式少
	- 通用寄存器多，采用组合逻辑
	- 便于实现指令流水
3. RISC 便于设计，可减低成本，提高可靠性
4. RISC 有利于编译程序代码优化
5. RISC 不易实现指令系统兼容

# 本章考研大纲
(一）指令格式
1. 指令的基本格式
2. 定长操作码指令格式
3. 扩展操作码指令格式

(二）指令的寻址方式
1. 有效地址的概念
2. 数据寻址和指令寻址
3. 常见寻址方式

(三）CISC和RISC的基本概念

