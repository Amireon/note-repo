# 第3章 系统总线
## 3.1 总线的基本概念
总线是一组能为多个部件分时共享的公共信息传送线路
- 总线： 连接多个部件的信息传输线，各个部件共享的传输介质
- 特点：同一时间，只能有一个部件向总线发送信息，当可以有多个设备从总线接收相同的信息

1. 以CPU为核心的双总线结构
	M 总线：连接 CPU 和主存
	I/O 总线：建立 ACPU 和个 I/O 设备之间交换信息的通道，各种 I/O 设备通过 I/O 接口挂到 I/O  总线上，便于增删设备
	缺点：当I/O设备与存储器交换信息时，占用CPU，降低工作效率
	![](https://raw.githubusercontent.com/Anlieh/PicBucket/master/20220915142137.png)
	
2. 单总线结构框图
	CPU、主存和 I/O 设备都挂在一组总线上
	需要设置总线判优逻辑

3. 以存储器为中心的双总线结构
	存储总线：在单主线基础上开辟出一条 CPU 与主存之间的总线
	![](https://raw.githubusercontent.com/Anlieh/PicBucket/master/20220915140943.png)

4. 三种总线结构比较分析
| 结构框图   | 优点                                  | 缺点                                                       |
| ---------- | ------------------------------------- | ---------------------------------------------------------- |
| 单总线结构 | 结构简单，成本低，易于接入新设备      | 带宽低，负载重；多个部件只能征用唯一的总线，不支持并发操作 |
| 双总线结构 | 将低速 I/O 设备从单总线上分离出来     | 需要增加通道等硬件设备                                     |
| 三总线结构 | 底稿了 I/O 设备的性能，提高系统吞吐量 | 系统工作效率较低

## 3.2 总线分类
### 1.按数据传输格式
串行总线
- 优点：只需要一条传输线，成本低廉，广泛应用于长距离传输;应用于计算机内部时，可以节省布线空间。
- 缺点：在数据发送和接收的时候要进行拆卸和装配，要考虑串行并行转换的问题

并行总线
- 优点: 总线的逻辑时序比较简单电路实现起来比较容易
- 缺点: 信号线数量多，占用更多的布线空间；远距离传输成本高昂；由于工作频率较高时，并行的信号线之间会产生严重干扰对每条线等长的要求也越高，所以无法持续提升工作频率


### 2.按总线功能
1.片内总线：芯片内部的总线

2.系统总线

计算机各部件之间的信息传输线

- 数据总线：指令和操作数等，双向，位数与机器字长、存储字长有关
- 地址总线：传输主存单元或I/O端口的地址等，单向，位数与存储地址、I/O地址有关
- 控制总线:  一根控制线传输一个信号，单向，但从整组来看有输出有输入

3.通信总线

- 用于计算机系统之间或计算机系统与其他系统之间的通信
- 按传输方式分为串行通信总线和并行通信总线


## 3.3 总线特性及性能指标
### 1.总线特性
1. 机械特性：尺寸、形状、管脚数、排列顺序
2. 电气特性：传输方向和有效的电平范围
3. 功能特性：每根传输线的功能：地址、数据、控制
4. 时间特性：信号的时序关系

### 2.总线性能指标
| 性能指标条目  | 含义                         |
| ------------- | ---------------------------- |
| 总线宽        | 数据线的根数                 |
| 标准传输率    | 每秒传输的最大字节数（MBps） |
| 时钟同步/异步 | 同步、不同步                 |
| 总线复用      | 地址线与数据线复用           |
| 信号线数      | 地址线、数据线和控制线的总和 |
| 总线控制方式  | 并发、自动、仲裁、逻辑、计数 |
| 其他          | 负载能力                             |

**总线带宽(标准传输率）**：`总线带宽 = 总线工作频率 * （总线宽度 / 8)` 

> 例题：总线龚总频率为 22MHz，总线宽度为 16位，则 总线带宽 = 22*(16/8) = 44MB/S

### 3.总线标准
![600](https://raw.githubusercontent.com/Anlieh/PicBucket/master/20220915144837.png)

## 3.4 总线结构
### 1.单总线结构

- 结构：CPU、主存、I/O设备（通过I/O接口）都连接在一组总线上，允许IO设备之间、I/O设备和CPU之间或I/0设备与主存之间直接交换信息
- 优点：结构简单，成本低，易于接入新的设备
- 缺点：带宽低、负载重y多个部件只能争用唯一的总线，且不支持并发传送操作

![image-20230131215246033](https://ypic.oss-cn-hangzhou.aliyuncs.com/202301312152116.png)

> 单总线并不是指只有一根信号线，系统总线按传送信息的不同可以细分为地址总线、数据总线和控制总线

### 2.双总线结构

- 结构：双总线结构有两条总线，一条是主存总线，用于CPU、主存和通道之间进行数据传送；另一条是I/O总线，用于多个外部设备与通道之间进行数据传送

- 优点：将较低速的I/O设备从单总线上分离出来，实现存储器总线和I/O总线分离。

- 缺点：需要增加通道等硬件设备

![image-20230131215552735](https://ypic.oss-cn-hangzhou.aliyuncs.com/202301312155825.png)

> 主存总线支持突发（猝发）传送：送出一个地址，收到多个地址连续的数据

> 通道是具有特殊功能的处理其，能对I/O设备进行统一管理，通道程序放在主存中

### 3.三总线结构

思路：将速率不同的I/O设备进行分类，然后将它们连接在不同通道上

- 结构：三总线结构是在计算机系统各部件之间采用3条各自独立的总线来构成信息通路，这3条总线分别为王仔总线、I/0总线和直接内存访问DMA总线
- 优点：提高了1/0设备的性能，使其更快地响应命令，提高系统吞吐量
- 缺点：系统工作效率较低，任意时刻只能使用一种总线，I/O总线只有CPU执行I/O指令时使用

![image-20230131220244212](https://ypic.oss-cn-hangzhou.aliyuncs.com/202301312202306.png)

### 4.四总线结构

了解即可

![image-20230131221122160](https://ypic.oss-cn-hangzhou.aliyuncs.com/202301312211274.png)

### 4.小结

![image-20230131221029537](https://ypic.oss-cn-hangzhou.aliyuncs.com/202301312210714.png)

## 3.5 总线控制
### 1.总线判优控制

总线上的各类设备按对总线有无控制权，分为
- 主设备(模块）：对总线有控制权
- 从设备(模块）：响应从主设备发来的总线命令

总线判优控制分为集中式和分布式，常见的三种集中控制判优方式如下：
|    查询方式    |                          优点                          |                      缺点                      | 控制线数量 |
| :------------: | :----------------------------------------------------: | :--------------------------------------------: | :--------: |
|    链式查询    | 只需少量控制线即可按优先次序实现总线控制；扩充设备简单 | 对电路故障敏感度高；优先级低的设备很难获得请求 |     2      |
| 计数器定时查询 |                   对电路故障敏感度低                   |                  增加了控制线                  | $log_2 n$  |
|    独立请求    |             响应速度快；优先级次序控制灵活             |          控制线数量过多，总线控制复杂          |     2n     |

链式查询

   [![image1](https://raw.githubusercontent.com/Amireon/PicBucket/master/20220921173826.png)]()



计数器定时查询
   ![](https://raw.githubusercontent.com/Anlieh/PicBucket/master/20220921174142.png)

独立请求
   ![](https://raw.githubusercontent.com/Anlieh/PicBucket/master/20220921174424.png)

### 2.总线通信控制
目的：解决通信双方协调配合的问题

**总线传输周期**

- 申请分配阶段：主模块申请，总线仲裁决定
- 寻址阶段：主模块向从模块给出地址和命令
- 传输阶段：主模块和从模块交换数据
- 结束阶段：主模块撤销有关消息

**总线通信的四种方式**

- 同步通信：由统一时标控制数据传送

- 异步通信：采用应答方式，没有公共时钟标准

- 半同步通信：同步、异步结合

- 分离式通信：充分挖掘系统总线每个瞬间的潜力

#### 同步通信

1. **同步式数据输入**
![](https://raw.githubusercontent.com/Anlieh/PicBucket/master/20220921193753.png)

2.**同步式数据输出**
![](https://raw.githubusercontent.com/Anlieh/PicBucket/master/20220921193913.png)

影响总线数据传输率的两方面因素：

- 数据宽度
- 总线始终频率或总线时钟周期

#### 异步通信
![](https://raw.githubusercontent.com/Anlieh/PicBucket/master/20220921193937.png)

异步串行通信传送字符的格式
![](https://raw.githubusercontent.com/Anlieh/PicBucket/master/20220921195351.png)

异步串行通信数据传送率
- 波特率：单位时间传送二进制数据的位数，单位 bps，记作波特
- 比特率：单位时间传送二进制有效数据的位数，单位 bps，

例题：在异步串行传输系统中，假设每秒传输120个数据帧，其字符格式规定包含1个始位，7个数据位，1个奇校验位，1个终止为，试计算波特率。
解：每帧的字符格式包含   `1+7+1+1=10位`，
		那么 `波特率 = 10 * 120 = 1200 bps 

#### 半同步通信

![](https://raw.githubusercontent.com/Anlieh/PicBucket/master/20220921200519.png)
- 半同步通信既保留了同步通信的所有特点，如所有的地址、命令、数据信号的发出时间，都严格参照系统时钟的某个前沿开始，而接受方都采用系统时钟后沿时刻来进行判断识别；
- 同时又像异步通信那样，允许不用速度的模块和谐地工作。

![](https://raw.githubusercontent.com/Anlieh/PicBucket/master/20220921201014.png)

以输入为例，在同步通信中，主模块在 T1 发出地址，在T2发出命令，在T3传输数据，在T4结束传输

![](https://raw.githubusercontent.com/Anlieh/PicBucket/master/20220921200545.png)

 #### 分离式通信
 ![](https://raw.githubusercontent.com/Anlieh/PicBucket/master/20220921201308.png)

#### 四种通信的特点

1. 同步通信、异步通信、半同步通信的共同点
   一个总线传输周期，以输入数据为例：
   -  主模块发地址、命令                   占用总线
   - 从模块准备数据                             不占用总线
   - 从模块向主模块发送数据            占用总线
   
2. 分离式通信的特点
   - 各模块有权申请占用总线
   - 采用同步通信方式，不等对方回答
   - 各模块准备数据时，不占用总线
   - 总线被占用时，无空闲
   - 充分提高了总线的有效占用
   

