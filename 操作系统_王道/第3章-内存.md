## 3.1 内存概述
内存是用于存放数据的硬件。程序执行前需要先放到内存中才能被CPU处理

**Q：如何区分各个程序的数据？**
给内存的存储单元编址
- 内存地址从O开始，每个地址对应一个存储单元
- 按字节编址，则每个存储单元的大小为1字节
- 按字编址，如字长为16位的计算机，则每个存储单元大小为1字，每个字的大小为16bit


### 1.内存管理
操作系统作为系统资源的管理者，也要对内存进行管理，那么应该做什么呢？
- 内存空间的分配与回收
- 从逻辑上对内存空间进行扩充
- 提供地址转换功能，负责程序程序的逻辑地址与物理地址的转换
- 内存保护，保证各进程在各自存储空间内互不干扰

**内存保护的两种方式**
1. 设置上下限寄存器
2. 重定位寄存器: 基址寄存器和界地址寄存器(限长寄存器)，越界检查，重定位寄存器中存放进程的起始物理地址，界地址寄存器中存放进程的最大逻辑地址


### 2.覆盖与交换
内存空间的扩充: 覆盖技术、交换技术、虚拟存储技术

**1.覆盖技术**
- 思想：将程序分为多个段（多个模块）常用的段常驻内存，不常用的段在需要时调入内存
- 内存中分为一个“固定区”和若干个“覆盖区”
- 需要常驻内存的段放在“固定区”中，调入后就不再调出（除非运行结束）
- 不常用的段放在“覆盖区”，需要用到时调入内存用不到时调出内存
- 缺点：必须由程序员声明覆盖结构，操作系统完成自动宥盖。缺点：对用户不透明，增加了用户编程负担，覆盖技术只用于早期的操作系统中，现在已成为历史

![](https://ypic.oss-cn-hangzhou.aliyuncs.com/202301161519587.png)

**2.交换技术**
交换（对换）技术的设计思想：内存空间紧张时，系统将内存中某些进程暂时换出外存，把外存中某些已具备运行条件的进程换入内存（进程在内存与磁盘间动态调度）
中级调度(内存调度): 决定将哪个处于挂起状态的进程重新调入内存

![](https://ypic.oss-cn-hangzhou.aliyuncs.com/202301161521877.png)

- 暂时换出外存等待的进程状态为挂起状态（挂起态，Suspend
- 挂起态又可以进一步细分为就绪桂起、阻塞挂起两种状态

**Question**
1. 被换出的进程应该保存在外存的什么位置？
2. 应该什么时候交换？
3. 应该换出哪些进程？

1. 具有对换功能的操作系统中，通常把磁盘空间分为文件区和对换区两部分。
	- 文件区主要用于存放文件，主要追求存储空间的利用率，因此对文件区空间的管理采用离散分配方式
	- 对换区空间只占磁盘空间的小部分，被换出的进程数据就存放在对换区。
	- 由于对换的速度直按影响到系统的整体速度，因此对换区空间的管理主要追求换人换出速度，因此通常对换区采用用连续分配万式。
	- 总之，对换区的I/O速度比文件区的更快
1. 交换通常在许多进程运行且内存吃紧时进行，而系统负荷降低就暂停。例如：在发现许多进程运行时经常发生缺页，就说明内存紧张，此时可以换出一些进程如果缺页率明显下降，就可以暂停换出
2. 可优先换出阻塞进程；可换出优先级低的进程;为了防止优先级低的进程在被调入内存后很快又被换出，有的系统还会考虑进程在内存的驻留时间. PCB常驻内存


### 3.连续分配管理方式
- 连续分配: 为用户进程分配的内存必须是一个连续的内存空间
- 三种方式: 单一连续分配、固定分区分配、动态分区分配

#### 1.单一连续分配
在单一连续分配方式中，内存被分为系统区和用户区
- 系统区: 通常位于内存的低地址部分，用于存放操作系统相关数据
- 用户区: 用于存放用户进程相关数据。内存中只能有一道用户程序，用户程序独占整个用户区空间。
- 优点：实现简单；无外部碎片；可以采用覆盖技术扩充内存；不一定需要采取内存保护
- 缺点：只能用于单用户、单任务的操作系统中；有内部碎片；存储器利用率极低。分配给果进杜的内存X域中如果有些部分没有月上，就是“内部碎片

![](https://ypic.oss-cn-hangzhou.aliyuncs.com/202301161538783.png)

#### 2.固定分区分配
将用户空间划分为若干个顶大小的分区，在每个分区中只装入一道作业
- 分区大小相等: 缺乏灵活性，适用于用一台计算机控制多个相同对象的场合
- 分区大小不等: 增加了灵活性，可以满足不同大小的进程需求，根据常在系统运行的作业大小情况进行划分

![](https://ypic.oss-cn-hangzhou.aliyuncs.com/202301161542595.png)

- 操作系统需要建立一个数据结构-分区说明表，来实现各个分区的分配与回收。
- 每个表项对应一个分区，通常按照分区大小排列
- 每个表项包括对应分区的大小、起始地址、状态

- 优点：实现简单，无外部碎片
- 缺点：当用户程序太大时，可能所有的分区都不能满足需求，只能采取覆盖技术；产生内部碎片，内存利用率低

#### 3.动态分区分配
动态分区分配：又称可变分区分配，不会预先划分内存分区，而是在进程装入内存时，根据进程的大小动态地建立分区。




**Q1.系统用什么样的数据结构记录内存的使用情况？**
- 空闲分区表: 每个空闲分区对应一个表项。表项中包含分区号、分区大小、分区起始地址等信息
- 空闲分区链: 每个分区的起始部分和末尾部分分别为前向指针和后向指针。起始部分处还可记录分区大小信息

![](https://ypic.oss-cn-hangzhou.aliyuncs.com/202301161626947.png)

**Q2.当很多个空闲分区都能满足需求时，应该选择哪个分区进行分配？**
把一个新作业装入内存时，须按照一定的动态分区分配算法，从空闲分区表（或空困分区链）中选出一个分区配给该作业。分配算法算法对系统性能有很大的影响

**Q3.如何进行分区的分配与回收操作？**







